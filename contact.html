<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroMart - Contact Us</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <!-- HEADER -->
    <header class="header">
        <div class="header-top">
            <button class="menu-btn mobile-only" id="menuBtn" aria-label="Open Menu">
                <i class="fas fa-bars"></i>
            </button>

            <div class="logo">
                <a href="home.html">
                    <span class="logo-icon">ðŸŒ¾</span>
                    <span class="logo-text">AgroMart</span>
                </a>
            </div>

            <nav class="desktop-nav" id="desktopNav">
                <a href="home.html" class="desk-nav-link">Home</a>
                <a href="products.html" class="desk-nav-link">Products</a>
                <a href="contact.html" class="desk-nav-link active">Contact Us</a>
            </nav>

            <div class="header-icons">
                <button class="icon-btn" id="searchBtn" aria-label="Search">
                    <i class="fas fa-search"></i>
                </button>
                <a href="cart.html" class="icon-btn cart-btn" aria-label="Cart">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
            </div>
        </div>

        <div class="search-box" id="searchBox">
            <input type="text" id="searchInput" placeholder="Search products...">
            <button class="search-close" id="searchClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </header>

    <!-- SIDE MENU (mobile) -->
    <div class="side-menu-overlay" id="sideMenuOverlay"></div>
    <nav class="side-menu" id="sideMenu">
        <div class="side-menu-header">
            <h2>Categories</h2>
            <button class="close-menu" id="closeMenu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <ul class="category-list" id="categoryList"></ul>
    </nav>

    <!-- CONTACT CONTENT -->
    <main class="main-content contact-page">
        <div class="contact-container">
            <!-- Left: Contact Form -->
            <div class="contact-form-section">
                <h2>Get in Touch</h2>
                <p>Have questions about our products? Fill out the form below.</p>

                <form id="contactForm">
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" placeholder="John Doe" required>
                    </div>

                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="example@gmail.com" required>
                        <small class="error-text" id="emailError"></small>
                    </div>

                    <div class="form-group">
                        <label for="message">Message (Max 1000 words)</label>
                        <textarea id="message" rows="5" placeholder="How can we help you?" maxlength="5000"
                            required></textarea>
                        <div class="char-count"><span id="wordCount">0</span>/1000 words</div>
                    </div>

                    <!-- Security Honeypot (hidden from users) -->
                    <div style="display:none !important;">
                        <input type="text" name="_honey" id="honeypot" tabindex="-1" autocomplete="off">
                    </div>

                    <!-- Page Load Timestamp (hidden) -->
                    <input type="hidden" id="pageLoadTime" value="">

                    <button type="submit" class="btn-primary btn-block">Send Message</button>
                </form>
            </div>

            <!-- Right: Let's Connect -->
            <div class="contact-info-section">
                <h2>Let's Connect</h2>
                <p>We are always here to help you.</p>

                <div class="info-card">
                    <a href="#" class="info-item" id="waConnect" target="_blank">
                        <div class="icon-box">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div class="info-text">
                            <h3>WhatsApp Us</h3>
                            <p id="displayPhone">Loading...</p>
                        </div>
                    </a>

                    <div class="info-item">
                        <div class="icon-box">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="info-text">
                            <h3>Email Us</h3>
                            <p id="displayEmail">Loading...</p>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="icon-box">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="info-text">
                            <h3>Visit Us</h3>
                            <p id="displayAddress">Loading...</p>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="site-footer" id="footer">
        <div class="footer-content">
            <div class="footer-col footer-about">
                <div class="footer-logo">
                    <span class="logo-icon">ðŸŒ¾</span>
                    <span class="logo-text">AgroMart</span>
                </div>
                <p>Your trusted partner for quality agricultural products. We provide premium fertilizers, pesticides,
                    and farming essentials at affordable prices.</p>

            </div>
            <div class="footer-col">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="home.html"><i class="fas fa-chevron-right"></i> Home</a></li>
                    <li><a href="products.html"><i class="fas fa-chevron-right"></i> Products</a></li>
                    <li><a href="cart.html"><i class="fas fa-chevron-right"></i> Cart</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Contact Us</h3>
                <ul class="footer-contact">
                    <li><i class="fas fa-phone"></i> <span id="footerPhone">+91 93164 24006</span></li>
                    <li><i class="fas fa-envelope"></i> info@agromart.com</li>
                    <li><i class="fas fa-map-marker-alt"></i> 123 Farm Road, Agricultural District</li>
                </ul>

            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 AgroMart. All rights reserved.</p>
        </div>
    </footer>

    <a href="#" class="whatsapp-float" id="whatsappFloat">
        <i class="fab fa-whatsapp"></i>
        <span>Need help? <br> Chat with us</span>
    </a>

    <!-- BOTTOM NAVIGATION (mobile only) -->
    <nav class="bottom-nav">
        <a href="home.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="products.html" class="nav-item">
            <i class="fas fa-shopping-bag"></i>
            <span>Products</span>
        </a>
        <a href="cart.html" class="nav-item">
            <i class="fas fa-shopping-cart"></i>
            <span>Cart</span>
            <span class="nav-cart-count" id="navCartCount">0</span>
        </a>
    </nav>

    <!-- TOAST -->
    <div class="toast" id="toast"></div>

    <script src="js/data.js"></script>
    <script src="js/global.js"></script>
    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Populate "Let's Connect" section
            const phone = getWhatsAppNumber();
            const email = getContactEmail();
            const address = getContactAddress();

            document.getElementById('displayPhone').textContent = `+${phone}`;
            document.getElementById('displayEmail').textContent = email;
            document.getElementById('displayAddress').textContent = address;

            const waLink = `https://wa.me/${phone}?text=${encodeURIComponent('Hello, I want to inquire about your products.')}`;
            const waConnect = document.getElementById('waConnect');
            if (waConnect) {
                waConnect.href = waLink;
            }

            // Form Logic
            const form = document.getElementById('contactForm');
            const messageInput = document.getElementById('message');
            const wordCount = document.getElementById('wordCount');

            // Security: Set page load time
            document.getElementById('pageLoadTime').value = Date.now();

            // Word count
            messageInput.addEventListener('input', () => {
                const words = messageInput.value.trim().split(/\s+/).filter(w => w.length > 0).length;
                wordCount.textContent = words;
                if (words > 1000) {
                    wordCount.style.color = 'red';
                } else {
                    wordCount.style.color = 'inherit';
                }
            });

            // Input Sanitization function
            function sanitizeInput(text) {
                const temp = document.createElement('div');
                temp.textContent = text;
                return temp.innerHTML;
            }

            // Rate Limiting helper
            function checkRateLimit() {
                const now = Date.now();
                const limitWindow = 30 * 60 * 1000; // 30 minutes
                const maxMessages = 5;

                let submissions = JSON.parse(localStorage.getItem('agro_contact_submissions') || '[]');

                // Filter out old submissions
                submissions = submissions.filter(time => (now - time) < limitWindow);

                if (submissions.length >= maxMessages) {
                    return false;
                }

                submissions.push(now);
                localStorage.setItem('agro_contact_submissions', JSON.stringify(submissions));
                return true;
            }

            form.addEventListener('submit', (e) => {
                e.preventDefault();

                // 1. Honeypot check
                const honey = document.getElementById('honeypot').value;
                if (honey) {
                    console.warn('Bot detected (honeypot)');
                    return; // Fail silently to confuse bots
                }

                // 2. Timing check
                const loadTime = parseInt(document.getElementById('pageLoadTime').value);
                const submitTime = Date.now();
                if (submitTime - loadTime < 5000) { // 5 seconds minimum
                    showToast('Slow down! Please wait a moment before sending.', 'error');
                    return;
                }

                // 3. Cooldown check (1 minute)
                const cooldown = checkMessagingCooldown('email');
                if (!cooldown.allowed) {
                    showToast(`Please wait ${cooldown.remaining}s before sending another message.`, 'error');
                    return;
                }

                const name = sanitizeInput(document.getElementById('name').value.trim());
                const userEmail = document.getElementById('email').value.trim();
                const message = sanitizeInput(messageInput.value.trim());

                // Gmail validation
                if (!userEmail.toLowerCase().endsWith('@gmail.com')) {
                    const err = document.getElementById('emailError');
                    err.textContent = 'Please use a valid @gmail.com address';
                    err.style.display = 'block';
                    return;
                } else {
                    document.getElementById('emailError').style.display = 'none';
                }

                const words = message.split(/\s+/).filter(w => w.length > 0).length;
                if (words > 1000) {
                    alert('Message exceeds 1000 words limit.');
                    return;
                }

                // Construct Gmail compose link
                const adminEmail = getContactEmail();
                const subject = encodeURIComponent(`Contact from ${name} via AgroMart`);
                const body = encodeURIComponent(`Name: ${name}\nEmail: ${userEmail}\nMessage:\n${message}`);

                const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${adminEmail}&su=${subject}&body=${body}`;

                // Open in a new tab
                window.open(gmailUrl, '_blank');
                showToast('Redirecting to Gmail...', 'success');
            });
        });
    </script>
</body>

</html>